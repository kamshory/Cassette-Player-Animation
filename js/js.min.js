function imageRotate(t,e){let s=document.createElement("canvas");s.width=t.width,s.height=t.height;let a=s.getContext("2d");return a.clearRect(0,0,s.width,s.height),a.save(),a.translate(s.width/2,s.height/2),a.rotate(180*e/Math.acos(-1)*Math.PI/180),a.drawImage(t,-t.width/2,-t.width/2),a.restore(),s}let lastPlayTime=new Date().getTime(),canvas=null,ctx=null;function initCassette(){ctx=(canvas=document.querySelector("#canvas")).getContext("2d")}function draw(){cassette.playing&&cassette.updatePosition(cassette.getDeltaTime());let t=cassette.getPosition();cassette.reel1.drawReel(t),cassette.reel2.drawReel(t),ctx.clearRect(0,0,canvas.width,canvas.height),ctx.drawImage(img2,0,0);let e={x:412,y:170},s={x:172,y:170},a={x:552,y:300},n={x:34,y:300};ctx.beginPath(),ctx.arc(e.x,e.y,47*cassette.reel1.radius,0,2*Math.PI,!1),ctx.fillStyle="#110404",ctx.fill(),ctx.lineWidth=1,ctx.strokeStyle="#110404",ctx.stroke(),ctx.beginPath(),ctx.arc(s.x,s.y,47*cassette.reel2.radius,0,2*Math.PI,!1),ctx.fillStyle="#110404",ctx.fill(),ctx.lineWidth=1,ctx.strokeStyle="#110404",ctx.stroke(),ctx.globalCompositeOperation="destination-out",ctx.beginPath(),ctx.arc(e.x,e.y,62,0,2*Math.PI,!1),ctx.fillStyle="#FFFFFF",ctx.fill(),ctx.lineWidth=1,ctx.strokeStyle="#FFFFFF",ctx.stroke(),ctx.beginPath(),ctx.arc(s.x,s.y,62,0,2*Math.PI,!1),ctx.fillStyle="#FFFFFF",ctx.fill(),ctx.lineWidth=1,ctx.strokeStyle="#FFFFFF",ctx.stroke(),ctx.globalCompositeOperation="source-over",ctx.drawImage(imageRotate(img1,cassette.reel1.angle),e.x-62,e.y-62),ctx.drawImage(imageRotate(img1,cassette.reel2.angle),s.x-62,s.y-62),ctx.lineWidth=1,ctx.strokeStyle="#ff0000";let r=getPont(1,e,a,47*cassette.reel1.radius),o=getPont(2,s,n,47*cassette.reel2.radius);ctx.lineWidth=1,ctx.strokeStyle="#484040",ctx.beginPath(),ctx.moveTo(n.x,n.y),ctx.lineTo(o.x,o.y),ctx.stroke(),ctx.lineWidth=1,ctx.strokeStyle="#484040",ctx.beginPath(),ctx.moveTo(a.x,a.y),ctx.lineTo(r.x,r.y),ctx.stroke(),cassette.cover&&ctx.drawImage(img3,0,0),cassette.position>=maxDuration&&(cassette.position=maxDuration);let c=getSong(sources,t);void 0!==c&&void 0!==c.src&&(document.querySelector(".line1").innerText=basename(c.src,"/")),document.querySelector(".line2").innerText=t.toFixed(2)+" / "+cassette.duration.toFixed(2),renderFrame(),window.requestAnimationFrame(draw)}function basename(t,e){return t.substr(t.lastIndexOf(e)+1)}function getSong(t,e){for(let s=0;s<t.length;s++)if(t[s].start<=e&&t[s].end>=e)return t[s];return""}function getDistance(t,e){return Math.sqrt((t.x-e.x)*(t.x-e.x)+(t.y-e.y)*(t.y-e.y))}function getSide(t,e){return Math.sqrt(t*t-e*e)}function contraGradient(t,e){return(t.y-e.y)/(t.x-e.x)}function getPont(t,e,s,a){let n=getDistance(e,s),r=getSide(n,a),o=Math.atan(contraGradient(e,s)),c=Math.asin(r/n),i={};if(1==t){let u=o+c-Math.PI/2;i={x:e.x+Math.cos(u)*a,y:e.y-Math.sin(u)*a}}if(2==t){let l=Math.PI/2+o-c;i={x:e.x-Math.cos(l)*a,y:e.y+Math.sin(l)*a}}return i}function setAttr(t,e,s){document.querySelector(t).setAttribute(e,s)}function flagPlayOn(){setAttr(".button-rewind","data-status","off"),setAttr(".button-fast-forward","data-status","off"),setAttr(".button-scan","data-status","off"),setAttr(".button-pause","data-status","off"),setAttr(".button-stop","data-status","off")}function flagRewindOn(){setAttr(".button-play","data-status","off"),setAttr(".button-fast-forward","data-status","off"),setAttr(".button-scan","data-status","off"),setAttr(".button-pause","data-status","off"),setAttr(".button-stop","data-status","off")}function flagFastForwardOn(){setAttr(".button-play","data-status","off"),setAttr(".button-rewind","data-status","off"),setAttr(".button-scan","data-status","off"),setAttr(".button-pause","data-status","off"),setAttr(".button-stop","data-status","off")}function flagScanOn(){setAttr(".button-play","data-status","off"),setAttr(".button-rewind","data-status","off"),setAttr(".button-fast-forward","data-status","off"),setAttr(".button-pause","data-status","off"),setAttr(".button-stop","data-status","off")}function flagPauseOn(){setAttr(".button-play","data-status","off"),setAttr(".button-rewind","data-status","off"),setAttr(".button-fast-forward","data-status","off"),setAttr(".button-stop","data-status","off")}function flagStopOn(){setAttr(".button-play","data-status","off"),setAttr(".button-rewind","data-status","off"),setAttr(".button-fast-forward","data-status","off"),setAttr(".button-stop","data-status","off")}window.onload=function(){document.querySelector(".button-play").addEventListener("click",function(t){let e=document.querySelector(".button-play"),s=e.getAttribute("data-status");"on"==s?(s="off",cassette.pause()):(s="on",flagPlayOn(),cassette.play()),e.setAttribute("data-status",s)}),document.querySelector(".button-rewind").addEventListener("click",function(t){let e=document.querySelector(".button-rewind"),s=e.getAttribute("data-status");"on"==s?(s="off",cassette.fastForwardOff(),cassette.rewindOff()):(s="on",flagRewindOn(),cassette.pause(),cassette.reversed?cassette.fastForwardOn():cassette.rewindOn()),e.setAttribute("data-status",s)}),document.querySelector(".button-fast-forward").addEventListener("click",function(t){let e=document.querySelector(".button-fast-forward"),s=e.getAttribute("data-status");"on"==s?(s="off",cassette.fastForwardOff(),cassette.rewindOff()):(s="on",flagFastForwardOn(),cassette.pause(),cassette.reversed?cassette.rewindOn():cassette.fastForwardOn()),e.setAttribute("data-status",s)}),document.querySelector(".button-scan").addEventListener("click",function(t){let e=document.querySelector(".button-scan"),s=e.getAttribute("data-status");"on"==s?(s="off",cassette.fastForwardOff(),cassette.rewindOff()):(s="on",flagScanOn(),cassette.pause(),cassette.scan()),e.setAttribute("data-status",s)}),document.querySelector(".button-pause").addEventListener("click",function(t){let e=document.querySelector(".button-pause"),s=e.getAttribute("data-status");"on"==s?(s="off",cassette.rewindOff(),cassette.fastForwardOff()):(s="on",flagPauseOn(),cassette.pause(),cassette.rewindOff(),cassette.fastForwardOff()),e.setAttribute("data-status",s)}),document.querySelector(".button-stop").addEventListener("click",function(t){let e=document.querySelector(".button-stop"),s=e.getAttribute("data-status");"on"==s?(s="off",cassette.rewindOff(),cassette.fastForwardOff()):(s="on",flagStopOn(),cassette.pause(),cassette.rewindOff(),cassette.fastForwardOff()),e.setAttribute("data-status",s)}),document.querySelector(".button-open").addEventListener("click",function(t){let e=document.querySelector(".button-open"),s=e.getAttribute("data-status");"on"==s?(s="off",cassette.closeCover()):(s="on",cassette.openCover()),e.setAttribute("data-status",s)}),document.addEventListener("keydown",function(t){" "==t.key||"Space"==t.code||32==t.keyCode?(document.querySelector(".button-play").click(),t.preventDefault(),t.stopPropagation()):"ArrowLeft"==t.code||37==t.keyCode?document.querySelector(".button-rewind").click():("ArrowRight"==t.code||39==t.keyCode)&&document.querySelector(".button-fast-forward").click()});let t=[],e=0;for(let s in sources){let a=new Request(sources[s].src);fetch(a).then(t=>t.blob()).then(a=>{let n=URL.createObjectURL(a),r=new Audio(n);r.onloadedmetadata=function(){let n=parseInt(s);songs[n]=r,t[n]=a,sources[n].duration=songs[n].duration,sources[n].index=n,++e==sources.length&&processBlobs(t)}})}};let songAll;function Counter(){this.currentTime=0,this.lastPlayTime=0,this.lastPlayPosition=0,this.started=!1,this.paused=!1,this.lastPosition=0,this.start=function(t){this.lastPlayPosition=t,this.lastPlayTime=new Date().getTime(),this.started=!0,this.paused=!1},this.pause=function(t){this.paused=!0},this.getPosition=function(){if(!this.started)return 0;if(this.paused)return this.lastPosition;let t=(new Date().getTime()-this.lastPlayTime)/1e3+this.lastPlayPosition;return t<0&&(t=0),this.lastPosition=t,t}}let context=new AudioContext,src=null,analyser=null,canvasAnalyzer=null,ctxAnalyzer=null,dataArray=null,bufferLength=4096,barWidth=10,barHeight=20;function connectToAnalizer(t,e){canvasAnalyzer=e,src=context.createMediaElementSource(t),analyser=context.createAnalyser(),e.width=window.innerWidth,e.height=window.innerHeight,ctxAnalyzer=e.getContext("2d"),src.connect(analyser),analyser.connect(context.destination),analyser.fftSize=256,bufferLength=analyser.frequencyBinCount,dataArray=new Uint8Array(bufferLength),barWidth=canvasAnalyzer.width/bufferLength*2.5}function renderFrame(){let t=0;analyser.getByteFrequencyData(dataArray),ctxAnalyzer.fillStyle="#121116",ctxAnalyzer.fillRect(0,0,canvasAnalyzer.width,canvasAnalyzer.height);for(let e=0;e<bufferLength;e++){let s=dataArray[e],a=s+25*(e/bufferLength),n=250*(e/bufferLength);ctxAnalyzer.fillStyle="rgb("+a+","+n+",50)",ctxAnalyzer.fillRect(t,canvasAnalyzer.height-s,barWidth,s),t+=barWidth+1}}function processBlobs(t){let e=0;for(let s in sources)sources[s].offset=e,sources[s].start=e,sources[s].end=e+sources[s].duration,e+=sources[s].duration;let a=new Blob(t),n=URL.createObjectURL(a);songAll=new Audio(n);let r=0,o=0;songAll.onloadedmetadata=function(){r=songAll.duration,o=songAll.duration,(cassette=new Cassette(songAll,r,o,sources,!1)).onPlay=function(t){document.querySelector(".layer1").classList.add("on"),document.querySelector(".layer1").classList.remove("off")},cassette.onPause=function(t){document.querySelector(".layer1").classList.add("off"),document.querySelector(".layer1").classList.remove("on")},cassette.onFoundSong=function(t){cassette.play();let e=document.querySelector(".button-play"),s=e.getAttribute("data-status");"on"==s?(s="off",cassette.pause()):(s="on",flagPlayOn(),cassette.play()),e.setAttribute("data-status",s)},connectToAnalizer(songAll,document.querySelector("#canvasanalyzer")),initCassette(),draw()}}let songs=[],duration=0,maxDuration=0,img1=new Image;img1.src="css/img/cs_wheel.png";let img2=new Image;img2.src="css/img/cs_back.png";let img3=new Image;img3.src="css/img/cs_front.png";let song,cassette,sources=[{src:"songs/Lagu 0010.mp3"},{src:"songs/Lagu 0011.mp3"},{src:"songs/Lagu 0012.mp3"},{src:"songs/Lagu 0015.mp3"},{src:"songs/Lagu 0016.mp3"},{src:"songs/Lagu 0017.mp3"},{src:"songs/Lagu 0018.mp3"},{src:"songs/Lagu 0019.mp3"}];